<!doctype html>
<html>
  <head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><title>MBapp Web</title></head>
  <body>
    <h1>MBapp Web</h1>
    <p><strong>Status:</strong> <span id="status">Loading tenants…</span></p>
    <p><strong>Calling:</strong> <code id="url"></code></p>
    <ul id="tenants"></ul>
    <script src="./env.js"></script>
    <script>
      (function() {
        function computeTenantsUrl() {
          try { const base=(window.API_BASE||"").trim().replace(/\/$/,""); if(base) return base+"/tenants"; } catch(e){}
          return "http://localhost:8080/tenants";
        }
        async function load() {
          const url = computeTenantsUrl();
          document.getElementById('url').textContent = url;
          try {
            const res = await fetch(url, { method:"GET", mode:"cors" });
            if (!res.ok) throw new Error("HTTP " + res.status);
            const tenants = await res.json();
            if (!Array.isArray(tenants)) throw new Error("Expected an array, got: " + JSON.stringify(tenants));
            document.getElementById('status').textContent = 'Tenants:';
            const ul = document.getElementById('tenants'); ul.innerHTML='';
            tenants.forEach(t => { const li=document.createElement('li'); li.textContent=`${t.id} — ${t.name}`; ul.appendChild(li); });
          } catch(e) { console.error("TENANTS fetch failed:", e); document.getElementById('status').textContent='Failed to load tenants'; }
        }
        load();
      })();
    </script>
  </body>
</html>
